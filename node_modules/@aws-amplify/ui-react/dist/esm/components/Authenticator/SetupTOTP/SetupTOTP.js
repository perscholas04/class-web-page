import{__awaiter as e}from"../../../node_modules/tslib/tslib.es6.js";import{jsx as t,jsxs as o}from"react/jsx-runtime";import i from"qrcode";import*as r from"react";import{Logger as s,Auth as a}from"aws-amplify";import{getActorState as n,translate as m}from"@aws-amplify/ui";import{Flex as d}from"../../../primitives/Flex/Flex.js";import{Heading as l}from"../../../primitives/Heading/Heading.js";import{useAuthenticator as p}from"../hooks/useAuthenticator/index.js";import{useCustomComponents as c}from"../hooks/useCustomComponents/index.js";import{useFormHandlers as u}from"../hooks/useFormHandlers/useFormHandlers.js";import{ConfirmSignInFooter as f}from"../shared/ConfirmSignInFooter.js";import{RemoteErrorMessage as h}from"../shared/RemoteErrorMessage.js";import{FormFields as g}from"../shared/FormFields.js";const j=new s("SetupTOTP-logger"),y=()=>{var s;const{_state:l,isPending:v}=p((e=>[e.isPending])),{handleChange:O,handleSubmit:b}=u(),{components:{SetupTOTP:{Header:H=y.Header,Footer:C=y.Footer}}}=c(),[x,T]=r.useState(!0),[w,F]=r.useState(),[S,P]=r.useState("COPY"),[V,k]=r.useState(""),L=n(l),{formFields:M,user:$}=L.context,{totpIssuer:q="AWSCognito",totpUsername:D=$.username}=null===(s=null==M?void 0:M.setupTOTP)||void 0===s?void 0:s.QR,E=r.useCallback((t=>e(void 0,void 0,void 0,(function*(){try{const e=yield a.setupTOTP(t);k(e);const o=`otpauth://totp/${q}:${D}?secret=${e}&issuer=${q}`,r=yield i.toDataURL(o);F(r)}catch(e){j.error(e)}finally{T(!1)}}))),[q,D]);r.useEffect((()=>{$&&E($)}),[E,$]);return t("form",Object.assign({"data-amplify-form":"","data-amplify-authenticator-setup-totp":"",method:"post",onChange:O,onSubmit:b},{children:o("fieldset",Object.assign({style:{display:"flex",flexDirection:"column"},className:"amplify-flex",disabled:v},{children:[t(H,{}),o(d,Object.assign({direction:"column"},{children:[x?o("p",{children:[m("Loading"),"â€¦"]}):t("img",{"data-amplify-qrcode":!0,src:w,alt:"qr code",width:"228",height:"228"}),o(d,Object.assign({"data-amplify-copy":!0},{children:[t("div",{children:V}),o(d,Object.assign({"data-amplify-copy-svg":!0,onClick:()=>{navigator.clipboard.writeText(V),P(m("COPIED"))}},{children:[t("div",Object.assign({"data-amplify-copy-tooltip":!0},{children:S})),t("svg",Object.assign({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},{children:t("path",{d:"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z"})}))]}))]})),t(g,{route:"setupTOTP"}),t(h,{})]})),t(f,{}),t(C,{})]}))}))};y.Header=()=>t(l,Object.assign({level:3},{children:m("Setup TOTP")})),y.Footer=()=>null;export{y as SetupTOTP};
