import{__awaiter as e}from"../../node_modules/tslib/tslib.es6.js";import{Hub as s,DataStore as t}from"aws-amplify";import{UI_CHANNEL as i,ACTION_DATASTORE_UPDATE_STARTED as o,EVENT_ACTION_DATASTORE_UPDATE as r,DATASTORE_QUERY_BY_ID_ERROR as d,ACTION_DATASTORE_UPDATE_FINISHED as a}from"./constants.js";import{getErrorMessage as m}from"../../helpers/utils.js";import{AMPLIFY_SYMBOL as n}from"../../helpers/constants.js";import{useTypeCastFields as l}from"./shared/useTypeCastFields.js";const c=({fields:c,id:f,model:p,schema:h})=>{const v=l({fields:c,modelName:p.name,schema:h});return()=>e(void 0,void 0,void 0,(function*(){try{s.dispatch(i,{event:o,data:{fields:v,id:f}},r,n);const e=yield t.query(p,f);if(!e)throw new Error(`${d}: ${f}`);const m=yield t.save(p.copyOf(e,(e=>{Object.assign(e,v)})));s.dispatch(i,{event:a,data:{fields:v,id:f,item:m}},r,n)}catch(e){s.dispatch(i,{event:a,data:{fields:v,id:f,errorMessage:m(e)}},r,n)}}))};export{c as useDataStoreUpdateAction};
